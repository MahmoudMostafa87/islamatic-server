<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Lecture</title>
    <link rel="stylesheet" href="styles.css">
</head>
<style>
    body {
    font-family: 'Arial', sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.container {
    background-color: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 500px;
}

h1 {
    text-align: center;
    color: #333;
    margin-bottom: 1.5rem;
}

.form-group {
    margin-bottom: 1.2rem;
}

label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
    color: #555;
}

input[type="text"],
textarea {
    width: 100%;
    padding: 0.8rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

textarea {
    resize: vertical;
    min-height: 100px;
}

input[type="file"] {
    padding: 0.5rem 0;
}

button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    width: 100%;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #45a049;
}

.error {
    color: #e74c3c;
    font-size: 0.8rem;
    margin-top: 0.3rem;
    display: block;
}

.message {
    margin-top: 1.5rem;
    padding: 0.8rem;
    border-radius: 4px;
    text-align: center;
}

.success {
    background-color: #d4edda;
    color: #155724;
}

.error-message {
    background-color: #f8d7da;
    color: #721c24;
}
</style>
<body>
    <div class="container">
        <h1>Add New Lecture</h1>
        <form id="lectureForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">Lecture Name:</label>
                <input type="text" id="name" name="name" required>
                <span class="error" id="nameError"></span>
            </div>
            
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" name="description" rows="4" required></textarea>
                <span class="error" id="descriptionError"></span>
            </div>
            
            <div class="form-group">
                <label for="Categoryname">Category Name:</label>
                <input type="text" id="Categoryname" name="Categoryname" required>
                <span class="error" id="categoryError"></span>
            </div>
            
            <div class="form-group">
                <label for="sound">Audio File:</label>
                <input type="file" id="sound" name="sound" accept="*" required>
                <span class="error" id="fileError"></span>
            </div>
            
            <button type="submit" id="submitBtn">Add Lecture</button>
        </form>
        
        <div id="message" class="message"></div>
    </div>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('lectureForm');
    const submitBtn = document.getElementById('submitBtn');
    const messageDiv = document.getElementById('message');
    
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Clear previous errors and messages
        clearErrors();
        messageDiv.className = 'message';
        messageDiv.textContent = '';
        
        // Get form data
        const formData = new FormData();
        formData.append('name', document.getElementById('name').value);
        formData.append('description', document.getElementById('description').value);
        formData.append('Categoryname', document.getElementById('Categoryname').value);
        formData.append('sound', document.getElementById('sound').files[0]);
        
        // Validate file type
        // const sound = document.getElementById('sound').files[0];
        // if (sound && !sound.type.startsWith('audio/')) {
        //     showError('fileError', 'Please upload an audio file');
        //     return;
        // }
        
        // Disable submit button during request
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        
        try {
            const response = await fetch('http://localhost:4000/lecture', {
                method: 'POST',
                credentials:"include",
                body: formData
            });
            
            const data = await response.json();
            
            if (response.ok) {
                // Success
                showMessage('Lecture added successfully!', 'success');
                form.reset();
            } else {
                // Handle errors
                console.log(data);
                if (data.message) {
                    if (data.error.includes('name already exist')) {
                        showError('nameError', 'This lecture name already exists');
                    } else if (data.error.includes('Category')) {
                        showError('categoryError', 'Category not found');
                    } else {
                        showMessage(data.error, 'error-message');
                    }
                } else {
                    showMessage('An error occurred. Please try again.', 'error-message');
                }
            }
        } catch (error) {
            console.error('Error:', error);
            showMessage('Network error. Please try again.', 'error-message');
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Add Lecture';
        }
    });
    
    function showError(elementId, message) {
        const errorElement = document.getElementById(elementId);
        errorElement.textContent = message;
    }
    
    function clearErrors() {
        const errorElements = document.querySelectorAll('.error');
        errorElements.forEach(el => el.textContent = '');
    }
    
    function showMessage(message, className) {
        messageDiv.textContent = message;
        messageDiv.className = 'message ' + className;
    }
});
</script>
</body>
</html>